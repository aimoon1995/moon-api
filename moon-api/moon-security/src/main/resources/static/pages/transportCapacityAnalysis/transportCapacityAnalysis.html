<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dp_css.css">
</head>
<style>
    .level_1{
        background-color: #C0C0C0;
    }
    .level_2{
        margin:10px 20px 10px 20px;
        background-color: #FFFFFF;
    }
    .level_3{
        /*margin: 40px 20px;*/
        padding: 20px;
    }
    .level_4{
        padding: 20px;
    }
    .level_5{
        height: 80px;
        border:1px solid #DCDCDC;
    }
    .level_6{
        width:25%;
        height: 100%;
        float:left;
    }
    .level_7{
        margin-left: 15%;
        margin-top: 18px;
    }
    .level_8{
        font-size: 20px;
        font-weight: bold;
    }

    #tableArea .dataTables_wrapper {
        position: relative;
        clear: both;
        zoom: 1;
        overflow-x: auto;
    }

    #tableAreaDaily .dataTables_wrapper {
        position: relative;
        clear: both;
        zoom: 1;
        overflow-x: auto;
    }

    #tableAreaDaily table{
        width: 800px;
    }

    #tableArea table{
        width: 800px;
    }
    body.modal-open {
        position: absolute !important;
    }
</style>
<body>
<div class="level_1">
    <div style="height: 1px;"></div>
    <!--运力概览-->
    <div class="level_2">
        <div style="height: 10px;"></div>
        <!--订单概览数据-->
        <div class="level_3">
            <div style="padding-bottom: 20px;font-size: 20px;font-family: 黑体;"><span>运力概览</span></div>
            <!-- 查询条件 -->
            <form id="driverViewExportFormId" action="#"  method="post" >
                <input  name="date" id="beginTimeExport" type="text" style="display: none">
                <input  name="operateUuid" id="operateUuidExport" type="text" style="display: none">
                <input  name="busiUuid" id="busiUuidExport" type="text" style="display: none">
            </form>
            <form class="form-inline"  id="driverViewFormId"  onsubmit="return false" style="">
                <label>日期：</label><input class="form-control  dateStr" readonly="readonly" name="date" id="beginTime" placeholder="日期" type="text">
                <label>城市：</label>
                <select  class="form-control"  id="operateUuid" name="operateUuid">
                    <option value="">请选择</option>
                </select>
                <label>业务类型：</label>
                <select  class="form-control" id="busiUuid" name="busiUuid">
                    <option value="">请选择</option>
                </select>
                <button class="layui-btn layui-btn-sm" id="searchDrvView" onclick="driverViewInit();"><i class="layui-icon">&#xe615;</i>查询</button>
                <button class="layui-btn layui-btn-sm" id="exportDrvView" onclick="driverViewExport();">导出</button>
            </form>
        </div>
        <div class="level_4">
            <div class="level_5">
                <div class="level_6">
                    <div class="level_7">
                        <span>司机总数</span>
                        <div class="level_8" id="totalDriver" name="totalDriver"></div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>成单司机数</span>
                        <div class="level_8" id="compleOrderDriver" name="compleDriver"></div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>累计激活司机数</span>
                        <div class="level_8" id="grandTotalDriver" name="grandTotalDriver"></div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>新增司机数</span>
                        <div class="level_8" id="newDriver" name="newDriver"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--运力趋势图表-->
    <div class="level_2">
        <div>
            <label style="font-size: 20px;margin: 25px 0 0 25px;font-weight: bold;">运力趋势</label>
            <!-- 查询条件 -->
            <form id="dataChartExportFormId" action="#"  method="post" >
                <input  name="startDate" id="startDateExport" type="text" style="display: none">
                <input  name="endDate" id="endDateExport" type="text" style="display: none">
            </form>
            <form class="form-inline"  id="dataChartFormId"  onsubmit="return false" style="margin:10px 25px;">
                <label>日期：</label>
                <input class="form-control" readonly="readonly" name="startDate" id="startDate" type="text">-
                <input class="form-control" readonly="readonly" name="endDate" id="endDate"  type="text">
                <button class="layui-btn layui-btn-sm" id="searchDataChart" onclick="dataChartInit();"><i class="layui-icon">&#xe615;</i>查询</button>
                <button class="layui-btn layui-btn-sm" id="exportDataChart" onclick="dataChartExport();">导出</button>
            </form>

            <div id="dataChart" class="chart" style="margin:0 30px 0 50px; height: 480px;"></div>
        </div>

        <div>
            <form id="drvInfoExportFormId" action="#"  method="post" >
                <input name="date" id="queryDateExport" type="text" style="display: none">
                <input name="drvName" id="drvNameExport" type="text" style="display: none">
                <input name="idCard" id="idCardExport" type="text" style="display: none">
            </form>
            <form class="form-inline"  id="drvInfoFormId"  onsubmit="return false" style="margin:10px 25px;">
                <label>日期：</label><input class="form-control  dateStr" readonly="readonly" name="date" id="queryDate" placeholder="日期" type="text">
                <label>司机姓名：</label><input class="form-control" type="text" id="drvName" name="drvName" placeholder="请输入司机姓名">
                <label>司机身份证：</label><input class="form-control" type="text" id="idCard" name="idCard" placeholder="请输入司机身份证">
                <button class="layui-btn layui-btn-sm" id="searchDrvInfo" ><i class="layui-icon">&#xe615;</i>查询</button>
                <button class="layui-btn layui-btn-sm" id="exportDrvInfo" onclick="drvInfoExport();">导出</button>
            </form>

            <div id="tableArea" style="margin:10px 25px;">
                <div class="widget-body no-padding" >
                    <table id="dt-table" class="table table-striped table-bordered table-hover " style="white-space: nowrap; margin:0 auto; width: 100%;">
                        <thead>
                        <tr>
                        </tr>
                        <tr>
                            <th>日期</th>
                            <th>司机姓名</th>
                            <th>身份证号</th>
                            <th>车牌号</th>
                            <th>接单数</th>
                            <th>成单数</th>
                            <th>查看趋势</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!--司机指标列表-->
    <div class="level_2" style="">
        <label style="font-size: 20px;margin: 25px 0 0 25px;font-weight: bold;">运力指标</label>
        <!-- 查询条件 -->
        <form id="drvDailyWorkExportFormId" action="#"  method="post" >
            <input  name="startDate" id="drvDailyWorkStartDateExport" type="text" style="display: none">
            <input  name="endDate" id="drvDailyWorkEndDateExport" type="text" style="display: none">
            <input  name="drvName" id="drvDailyWorkNameExport" type="text" style="display: none">
            <input  name="idCard" id="drvDailyWorkCardExport" type="text" style="display: none">
            <input  name="colListName" id="colListName" type="text" style="display: none">
        </form>
        <form class="form-inline"  id="drvDailyWorkFormId"  onsubmit="return false" style="margin:10px 25px;">
            <label>日期：</label>
            <input class="form-control" readonly="readonly" name="startDate" id="drvDailyWorkStartDate" type="text" >-
            <input class="form-control" readonly="readonly" name="endDate" id="drvDailyWorkEndDate"  type="text" >
            <label>司机姓名：</label><input class="form-control" type="text" id="drvDailyWorkName" name="drvName" placeholder="请输入司机姓名">
            <label>司机身份证：</label><input class="form-control" type="text" id="drvDailyWorkCard" name="idCard" placeholder="请输入司机身份证">
            <button class="layui-btn layui-btn-sm" id="searchDrvDailyWorkChart" ><i class="layui-icon">&#xe615;</i>查询</button>
            <div class="btn-group">
                <button class="layui-btn layui-btn-sm" data-toggle="dropdown">导出</button>
                <ul class="dropdown-menu">
                    <li><p class="drvDailyWorkExport" style="margin: 5px;" onclick="drvDailyWorkExport(1);">导出列表</p></li>
                    <li><p class="drvDailyWorkExportCustom" style="margin: 5px;" onclick="drvDailyWorkExport(2);">导出-自定义</p></li>
                </ul>
            </div>
            <!--<button class="layui-btn layui-btn-sm" id="exportDrvDailyWorkChart" onclick="drvDailyWorkExport();"><i class="layui-icon">&#xe615;</i>导出</button>-->
        </form>

        <div id="tableAreaDaily" style="margin:10px 25px;">
            <div class="widget-body no-padding" >
                <table id="dt-table2" class="table table-striped table-bordered table-hover " style="white-space: nowrap; margin:0 auto; width: 100%;">
                    <thead>
                    <tr>
                    </tr>
                    <tr>
                        <th>日期</th>
                        <th>司机姓名</th>
                        <th>司机身份证</th>
                        <th>司机手机号</th>
                        <th>注册天数</th>
                        <th>车牌号</th>
                        <th>车辆型号</th>
                        <th>出勤天数</th>
                        <th>当月出勤率</th>
                        <th>接单数</th>
                        <th>成单数</th>
                        <th>日流水</th>
                        <th>日附加费</th>
                        <th>在线小时</th>
                        <th>服务小时</th>
                        <th>在线里程</th>
                        <th>服务里程</th>
                        <th>评分</th>
                        <th>呼出率</th>
                        <th>早高峰</th>
                        <th>晚高峰</th>
                    </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>

    </div>
    <div style="height: 1px;"></div>
</div>

<!-- START 司机分时趋势弹窗 -->
<div class="modal " id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" >
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <h4 class="modal-title" id="myModalLabel" style="float: left">
                    趋势分析
                </h4>
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <div id="drvHourOrderChart" class="chart" style="margin:0 30px 0 50px; height: 380px;"></div>
            </div>
        </div>
    </div>
</div>
</div>
<!-- END 司机分时趋势弹窗 -->

<!-- START 自定义导出弹窗 -->
<!-- 模态框（Modal） -->
<div class="modal " id="myModal_1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" >
                    自定义导出
                </h4>
            </div>
            <div class="modal-body">
                <!--在这里添加一些文本-->
                <div class="row-fluid">
                    <div class="span12">
                        <form action="#" method="post" class="form-horizontal">
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="日期"/>日期
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="司机姓名"/>司机姓名
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="司机身份证"/>司机身份证
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="司机手机号"/>司机手机号
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="注册天数"/>注册天数
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="车牌号"/>车牌号
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="车辆型号"/>车辆型号
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="出勤天数"/>出勤天数
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="当月出勤率"/>当月出勤率
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="接单数"/>接单数
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="成单数"/>成单数
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="日流水"/>日流水
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="日附加费"/>日附加费
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="在线小时"/>在线小时
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="服务小时"/>服务小时
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="在线里程"/>在线里程
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="服务里程"/>服务里程
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="评分"/>评分
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="呼出率"/>呼出率
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="早高峰"/>早高峰
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="drvList" value="晚高峰"/>晚高峰
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="drvCunlomSave">确认</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- END 自定义导出弹窗 -->
</body>
</html>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/echarts/echarts.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript" src="../../js/libs/bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript">
    var myDate=new Date(new Date() - 1000 * 60 * 60 * 24),
        yestery= myDate.getFullYear(),
        yesterm=myDate.getMonth()+1,
        yesterd=myDate.getDate(),
        yesterh=myDate.getHours(),
        yestermin=myDate.getMinutes(),
        yesters=myDate.getSeconds(),
        yesterDay=yestery+"-"+yesterm+"-"+yesterd+" "+yesterh+":"+yestermin+":"+yesters;

    window.onload=function(){
        layui_load();
    }

    function layui_load(){
        layui.use('layer', function(){
            var layer = layui.layer;

            layer.ready(function(){
                dateInit();
                driverViewInit();
                dataChartInit();
                listInit();
                serchInit();
            });
        });

        layui.use(['layer','laydate'], function(){
            var layer = layui.layer;
            var laydate = layui.laydate;
            laydate.render({
                elem: '#beginTime',//指定元素
                type:'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                btns:['confirm'],
                max: yesterDay,
                // done: function (value, date, endDate) {
                //     var beginTime = new Date($('#beginTime').val()).getTime();
                //     if (beginTime > new Date(yesterDay).getTime()) {
                //         layer.msg('日期最大为昨天');
                //         $('#beginTime').val(yesterDay.substr(0,10));
                //     }
                //     if(!$("input[id=beginTime]").val()){
                //         layer.msg('日期必填');
                //         $('#beginTime').val(yesterDay.substr(0,10));
                //     }
                // }
            });
            laydate.render({
                elem: '#startDate',
                format: 'yyyy-MM-dd',
                btns:['confirm'],
                max: yesterDay,
                done: function (value, date, endDate) {
                    var startDate = new Date(value).getTime();
                    var endTime = new Date($('#endDate').val()).getTime();
                    if (endTime < startDate) {
                        layer.msg('开始时间不能大于结束时间');
                        $('#startDate').val($('#endDate').val());
                    }
                }
            });
            laydate.render({
                elem: '#endDate',
                format: 'yyyy-MM-dd',
                btns:['confirm'],
                max: yesterDay,
                done: function (value, date, endDate) {
                    var startDate = new Date($('#startDate').val()).getTime();
                    var endTime = new Date(value).getTime();
                    if (endTime < startDate) {
                        layer.msg('结束时间不能小于开始时间');
                        $('#endDate').val($('#startDate').val());
                    }
                }
            });
            laydate.render({
                elem: '#queryDate',
                type:'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                btns:['confirm'],
                max: yesterDay
            });
            laydate.render({
                elem: '#drvDailyWorkStartDate',
                type:'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                btns:['confirm'],
                max: yesterDay,
                done: function (value, date, endDate) {
                    var startDate = new Date(value).getTime();
                    var endTime = new Date($('#drvDailyWorkEndDate').val()).getTime();
                    if (endTime < startDate) {
                        layer.msg('开始时间不能大于结束时间');
                        $('#drvDailyWorkStartDate').val($('#drvDailyWorkEndDate').val());
                    }
                }
            });
            laydate.render({
                elem: '#drvDailyWorkEndDate',
                type:'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                btns:['confirm'],
                max: yesterDay,
                done: function (value, date, endDate) {
                    var startDate = new Date($('#drvDailyWorkStartDate').val()).getTime();
                    var endTime = new Date(value).getTime();
                    if (endTime < startDate) {
                        layer.msg('结束时间不能小于开始时间');
                        $('#drvDailyWorkEndDate').val($('#drvDailyWorkStartDate').val());
                    }
                }
            });
        });

    }

    function dateInit(){
        var day1 = new Date();
        day1.setTime(day1.getTime()-24*60*60*1000);
        var s1 = day1.getFullYear()+"-" + ((day1.getMonth()+1)<10?('0'+(day1.getMonth()+1)):(day1.getMonth()+1)) + "-" + (day1.getDate()<10?('0'+day1.getDate()):day1.getDate());

        $('#beginTime').val(s1);

        $('#startDate').val(s1);
        $('#endDate').val(s1);

        $('#queryDate').val(s1);

        $('#drvDailyWorkStartDate').val(s1);
        $('#drvDailyWorkEndDate').val(s1);
    }

    function serchInit() {
        $.ajax({
            type : 'get',
            url : '/common/getCity',
            success : function(d) {
                var data = d.data;
                var str = "<option value=''>请选择</option>";
                for (var i=0;i<data.length;i++){
                    var uuid = data[i].uuid;
                    var name = data[i].name;
                    str+="<option value="+uuid+">"+name+"</option>";
                }
                $("#operateUuid").html(str);
            }
        });
        $.ajax({
            type : 'get',
            url : '/common/getBusi',
            success : function(d) {
                var data = d.data;
                var str = "<option value=''>请选择</option>";
                for (var i=0;i<data.length;i++){
                    var uuid = data[i].uuid;
                    var label = data[i].label;
                    str+="<option value="+uuid+">"+label+"</option>";
                }
                $("#busiUuid").html(str);
            }
        });
    }

    function driverViewInit(){
        $.ajax({
            type : 'get',
            url : '/transportCapacity/getDriverView',
            data:$("#driverViewFormId").serialize(),
            success : function(data) {
                $("#totalDriver").html(data.totalDriver);
                $("#compleOrderDriver").html(data.compleOrderDriver);
                $("#grandTotalDriver").html(data.grandTotalDriver);
                $("#newDriver").html(data.newDriver);
            }
        });
    }

    function driverViewExport() {
        $("#beginTimeExport").val($("#beginTime").val());
        $("#operateUuidExport").val($("#operateUuid").val());
        $("#busiUuidExport").val($("#busiUuid").val());
        $('#driverViewExportFormId').attr("action", "/transportCapacity/getDriverViewExport");
        $('#driverViewExportFormId').submit();
    }

    function dataChartExport() {
        var startDate = $('#startDate').val();
        var endDate=$('#endDate').val();

        if(!checkDatelimit(startDate,endDate)){
            alert("日期选择跨度不能超过一个月");
            return;
        }

        $("#startDateExport").val($("#startDate").val());
        $("#endDateExport").val($("#endDate").val());
        $('#dataChartExportFormId').attr("action", "/transportCapacity/getDataChartExport");
        $('#dataChartExportFormId').submit();
    }

    //运力趋势 数据
    function dataChartInit() {
        var startDate = $('#startDate').val();
        var endDate=$('#endDate').val();

        if(!checkDatelimit(startDate,endDate)){
            alert("日期选择跨度不能超过一个月");
            return;
        }

        $.ajax({
            type : 'get',
            url : '/transportCapacity/dataChart',
            data:$("#dataChartFormId").serialize(),
            beforeSend : function(){
                layer.msg("加载中", {
                    icon: 16,
                    shade: [0.6, '#000005'],//遮罩的颜色与透明度
                    time: false  //取消自动关闭
                })

            },
            success : function(data) {
                layer.closeAll();
                var sendArr=data.sendOrder;
                var receiveArr=data.receiveOrder;
                var completeArr=data.completeOrder;
                var listenDriArr=data.listenDriver;
                var receiveDriArr=data.receiveDriver;
                var completeDriArr=data.completeDriver;
                var rateArr=data.orDrRate;
                var XDate = data.XDate;

                var chart=echarts.init(document.getElementById('dataChart'));

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    grid: {
                        top:'10%',
                        right: '10%'
                    },
                    toolbox: {
                        feature: {
                            dataView: {show: false, readOnly: false},
                            restore: {show: false},
                            saveAsImage: {show: false}
                        }
                    },

                    legend: {
                        icon: 'circle',
                        itemWidth: 6,
                        itemGap: 20,
                        textStyle: {
                            color: '#556677'
                        }
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisTick: {
                                alignWithLabel: true
                            },
                            data: XDate //['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23']
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '',
                            position: 'left',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '(%)',
                            position: 'right',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
                    ],
                    series: [{
                        type: 'line',
                        name: '下单数',
                        data: sendArr,
                        smooth:true,
                        color:'#3AA1FF'
                    }, {
                        type: 'line',
                        name: '接单数',
                        data: receiveArr,
                        smooth:true,
                        color:'#5EC67D'
                    }, {
                        type: 'line',
                        name: '成单数',
                        data: completeArr,
                        smooth:true,
                        color:'#ff3442'
                    },{
                        type: 'line',
                        name: '听单司机数',
                        data: listenDriArr,
                        smooth:true,
                        color:'#FFA07A'
                    }, {
                        type: 'line',
                        name: '接单司机数',
                        data: receiveDriArr,
                        smooth:true,
                        color:'#ff97fa'
                    }, {
                        type: 'line',
                        name: '成单司机数',
                        data: completeDriArr,
                        smooth:true,
                        color:'#7bfff3'
                    }, {
                        type: 'line',
                        name: '单司比(%)',
                        data: rateArr,
                        smooth:true,
                        yAxisIndex: 1,
                        color:'#FFFF00'
                    }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                chart.setOption(option);
            },
            error : function(data) {
                layer.closeAll();
            }
        });
    }

    //司机信息
    var example;
    //司机日考核
    var example;
    function listInit(){
        example =
            $('#dt-table').DataTable({
                "searching": false,
                "processing": false,
                "serverSide" : true,
                "language": {
                    "url": "/js/plugin/datatables/Chinese.lang"
                },
                "ajax": {
                    "url" : "/transportCapacity/drvInfo",
                    "type":"get",
                    "data":function(d){
                        d.date = $('#queryDate').val();
                        d.drvName = $('#drvName').val();
                        d.idCard = $('#idCard').val();
                    },
                    "error":function(xhr, textStatus, errorThrown){
                        var msg = xhr.responseText;
                        console.log(msg);
                        var response = JSON.parse(msg);
                        var code = response.code;
                        var message = response.message;
                        if (code == 400) {
                            layer.msg(message);
                        } else if (code == 401) {
                            localStorage.removeItem("token");
                            layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
                                location.href = '/login.html';
                            });
                        } else if (code == 403) {
                            console.log("未授权:" + message);
                            layer.msg('未授权');
                        } else if (code == 500) {
                            layer.msg('系统错误：' + message);
                        }
                    }
                },
                "dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
                "columns": [
                    {"data" : "date", "defaultContent" : "","orderable":false},
                    {"data" : "actualName", "defaultContent" : "","orderable":false},
                    {"data" : "idcard","defaultContent" : "","orderable":false},
                    {"data" : "vehicleNo", "defaultContent" : "","orderable":false},
                    {"data" : "countJD", "defaultContent" : "","orderable":false},
                    {"data" : "countCD", "defaultContent" : "","orderable":false},
                    {"data" : "", "defaultContent" : "","orderable":false}
                ],
                "aoColumnDefs":[
                    {//倒数第一列
                        "targets":-1,
                        "bSortable": false,
                        render: function(data, type, row) {
                            var html ='<span date='+ row["date"]+' drvUuid='+ row["drvUuid"]+' id="queryDrvHour" style="color: #40AFFE">查询趋势</span>&nbsp;&nbsp;&nbsp;&nbsp;';
                            return html;
                        }
                    },
                ]
            } );

        example2 =
            $('#dt-table2').DataTable({
                "searching": false,
                "processing": false,
                "serverSide" : true,
                "language": {
                    "url": "/js/plugin/datatables/Chinese.lang"
                },
                "ajax": {
                    "url" : "/transportCapacity/driverDailyWork",
                    "type":"get",
                    "data":function(d){
                        d.startDate = $('#drvDailyWorkStartDate').val();
                        d.endDate = $('#drvDailyWorkEndDate').val();
                        d.drvName = $('#drvDailyWorkName').val();
                        d.idCard = $('#drvDailyWorkCard').val();
                    },
                    "error":function(xhr, textStatus, errorThrown){
                        var msg = xhr.responseText;
                        console.log(msg);
                        var response = JSON.parse(msg);
                        var code = response.code;
                        var message = response.message;
                        if (code == 400) {
                            layer.msg(message);
                        } else if (code == 401) {
                            localStorage.removeItem("token");
                            layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function(){
                                location.href = '/login.html';
                            });
                        } else if (code == 403) {
                            console.log("未授权:" + message);
                            layer.msg('未授权');
                        } else if (code == 500) {
                            layer.msg('系统错误：' + message);
                        }
                    }
                },
                "dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
                "columns": [
                    {"data" : "workday", "defaultContent" : "","orderable":false},
                    {"data" : "driverName", "defaultContent" : "","orderable":false},
                    {"data" : "driverIdcard", "defaultContent" : "","orderable":false},
                    {"data" : "driverMobile", "defaultContent" : "","orderable":false},
                    {"data" : "driverCreateDay", "defaultContent" : "","orderable":false},
                    {"data" : "vehicleNo", "defaultContent" : "","orderable":false},
                    {"data" : "vehicleBaseName", "defaultContent" : "","orderable":false},
                    {"data" : "workDays", "defaultContent" : "","orderable":false},
                    {"data" : "workDaysRate", "defaultContent" : "","orderable":false},
                    {"data" : "countConfirm", "defaultContent" : "","orderable":false},
                    {"data" : "countComplete", "defaultContent" : "","orderable":false},
                    {"data" : "totalIncome", "defaultContent" : "","orderable":false},
                    {"data" : "surcharge", "defaultContent" : "","orderable":false},
                    {"data" : "onlineTime", "defaultContent" : "","orderable":false},
                    {"data" : "onserviceTime", "defaultContent" : "","orderable":false},
                    {"data" : "onlineMileage", "defaultContent" : "","orderable":false},
                    {"data" : "serviceMileage", "defaultContent" : "","orderable":false},
                    {"data" : "averageScore", "defaultContent" : "","orderable":false},
                    {"data" : "callRate", "defaultContent" : "","orderable":false},
                    {"data" : "earlyTimeComplete", "defaultContent" : "","orderable":false},
                    {"data" : "lateTimeComplete", "defaultContent" : "","orderable":false},
                ]
            } );

    }
    /**
     * 查看
     */

    $("body").on("click","#queryDrvHour",function () {
        $('#myModal').modal('show');
        var date=$(this).attr("date");
        var drvUuid=$(this).attr("drvUuid");
        drvHourOrder(date,drvUuid);

    });

    /**
     * 趋势分析
     */
    function drvHourOrder(date,drvUuid) {
        $.ajax({
            type : 'get',
            async: false,
            url : '/transportCapacity/drvOrder',
            data: {
                date : date,
                drvUuid : drvUuid
            },
            beforeSend : function(){

            },
            success : function(data) {
                layer.closeAll();
                var receiveArr=data.receiveOrder;
                var completeArr=data.completeOrder;

                var chart=echarts.init(document.getElementById('drvHourOrderChart'));

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    grid: {
                        top:'10%',
                        right: '10%'
                    },
                    toolbox: {
                        feature: {
                            dataView: {show: false, readOnly: false},
                            restore: {show: false},
                            saveAsImage: {show: false}
                        }
                    },

                    legend: {
                        icon: 'circle',
                        itemWidth: 6,
                        itemGap: 20,
                        textStyle: {
                            color: '#556677'
                        }
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisTick: {
                                alignWithLabel: true
                            },
                            data: ['00','01','02','03','04','05','06','07','08','09','10','11','12','13','14','15','16','17','18','19','20','21','22','23']
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '',
                            position: 'left',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
                    ],
                    series: [{
                        type: 'line',
                        name: '接单数',
                        data: receiveArr,
                        smooth:true,
                        color:'#5EC67D'
                    }, {
                        type: 'line',
                        name: '成单数',
                        data: completeArr,
                        smooth:true,
                        color:'#ff3442'
                    }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                chart.setOption(option);

            },
            error : function(data) {
                layer.closeAll();
            }
        });
    }

    //司机信息查询
    $("#searchDrvInfo").click(function(){
        example.ajax.reload();
    });
    //司机日考核查询
    $("#searchDrvDailyWorkChart").click(function(){
        var startDate = $('#drvDailyWorkStartDate').val();
        var endDate=$('#drvDailyWorkEndDate').val();

        if(!checkDatelimit(startDate,endDate)){
            alert("日期选择跨度不能超过一个月");
            return;
        }else {
            example2.ajax.reload();
        }
    });

    function drvInfoExport(){
        $("#queryDateExport").val($("#queryDate").val());
        $("#drvNameExport").val($("#drvName").val());
        $("#idCardExport").val($("#idCard").val());
        $('#drvInfoExportFormId').attr("action", "/transportCapacity/getDrvInfoExport");
        $('#drvInfoExportFormId').submit();
    }

    function drvDailyWorkExport(type){
        $("#drvDailyWorkStartDateExport").val($("#drvDailyWorkStartDate").val());
        $("#drvDailyWorkEndDateExport").val($("#drvDailyWorkEndDate").val());
        $("#drvDailyWorkNameExport").val($("#drvDailyWorkName").val());
        $("#drvDailyWorkCardExport").val($("#drvDailyWorkCard").val());

        if(type==2){
            $("[name='drvList']").removeAttr("checked");
            $('#myModal_1').modal('show');

        }else{
            $("#colListName").val("");
            $('#drvDailyWorkExportFormId').attr("action", "/transportCapacity/driverDailyWorkDataExport");
            $('#drvDailyWorkExportFormId').submit();
        }
    }
    //自定义导出确认`
    $('#drvCunlomSave').on('click', function () {
        $('#myModal_1').modal('hide');
        var str = "";
        $("input[name='drvList']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                str += $(this).attr("value") + ",";
            }
        });
        str += "序号";
        $("#colListName").val(str);
        $('#drvDailyWorkExportFormId').attr("action","/transportCapacity/driverDailyWorkDataExport");
        $('#drvDailyWorkExportFormId').submit();
    });

    function dailyModalClose(){
        $('#myModal_1').modal('hide');
    }

</script>
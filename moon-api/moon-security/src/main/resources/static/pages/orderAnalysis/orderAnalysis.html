<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Insert title here</title>
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dataTables.bootstrap.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../layui/css/layui.css">
    <link rel="stylesheet" type="text/css" media="screen" href="../../css/dp_css.css">
</head>
<style>
    .lab_1 {
        text-align: right;
    }

    li {
        display: inline-block;
        margin-left: 25px;
    }

    li {
        *display: inline;
        *zoom: 1;
    }

    span {
        margin: 0 30px;
    }

    p {
        line-height: 3;
    }

    #tableArea .dataTables_wrapper {
        position: relative;
        clear: both;
        zoom: 1;
        overflow-x: auto;
    }

    #tableArea table {
        width: 800px;
    }

    .level_1 {
        background-color: #C0C0C0;
    }

    .level_2 {
        margin: 10px 20px;
        background-color: #FFFFFF;
    }

    .level_3 {
        /*margin: 40px 20px;*/
        padding: 20px;
    }

    .level_4 {
        border: 1px solid #DCDCDC;
    }

    .level_5 {
        height: 80px;
    }

    .level_6 {
        width: 25%;
        height: 100%;
        float: left;
    }

    .level_7 {
        margin-left: 15%;
        margin-top: 18px;
    }

    .level_8 {
        font-size: 20px;
        font-weight: bold;
    }

    span {
    }
</style>
<body>
<div class="level_1">
    <div style="height: 10px;"></div>
    <div class="level_2">
        <div style="height: 10px;"></div>
        <!--订单概览数据-->
        <div class="level_3">
            <div style="padding-bottom: 20px;font-size: 20px;font-family: 黑体;"><span>订单概览</span></div>
            <!-- 查询条件 -->
            <form id="exportFormId" action="#" method="post">
                <input name="date" id="beginTimeExport" type="text" style="display: none">
                <input name="originCity" id="originCityExport" type="text" style="display: none">
                <input name="busiUuid" id="busiUuidExport" type="text" style="display: none">
                <input name="source" id="sourceExport" type="text" style="display: none">
            </form>
            <form class="form-inline" id="orderViewFormId" onsubmit="return false" style="">
                <label>日期：</label><input class="form-control  dateStr" readonly="readonly" name="date" id="beginTime"
                                         placeholder="日期" type="text">
                <label>城市：</label>
                <select class="form-control" id="originCity" name="originCity">
                    <option value="">请选择</option>
                </select>
                <label>业务类型：</label>
                <select class="form-control" id="busiUuid" name="busiUuid">
                    <option value="">请选择</option>
                </select>
                <label>渠道：</label>
                <select class="form-control" id="source" name="source">
                    <option value="" selected="selected">请选择</option>
                    <option value="100">美团</option>
                    <option value="1">和行</option>
                    <option value="200">滴滴</option>
                </select>
                <button class="layui-btn layui-btn-sm" id="searchBt" onclick="orderViewInit();"><i class="layui-icon">&#xe615;</i>查询
                </button>
                <button class="layui-btn layui-btn-sm" id="exportBt" onclick="orderViewExport();"><i
                        class="layui-icon"></i>导出
                </button>
            </form>
        </div>
        <div class="level_4">
            <div class="level_5">
                <div class="level_6">
                    <div class="level_7">
                        <span>下单数</span>
                        <div class="level_8" id="xd" style="padding-left: 32px;" name="totalPass">0</div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>接单数</span>
                        <div class="level_8" id="jd" style="padding-left: 32px;" name="dayNewPass">0</div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>成单数</span>
                        <div class="level_8" id="cd" style="padding-left: 32px;" name="dayNewAPPPass">0</div>
                    </div>
                </div>
                <div class="level_6">
                    <div class="level_7">
                        <span>成单率</span>
                        <div class="level_8" id="cdl" style="padding-left: 32px;" name="dayLoginPass">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div style="height: 10px;"></div>
    </div>

    <!--订单趋势----日期对比图-->
    <div class="level_2" style="height: 700px;margin-bottom: 0px;">
        <ul id="myTab" class="nav nav-tabs" style="font-size: 20px;font-family: 黑体;margin-left: 10px;">
            <li class="active">
                <a href="#tab_1" data-toggle="tab">订单趋势</a>
            </li>
            <li>
                <a href="#tab_2" data-toggle="tab">日期对比</a>
            </li>
        </ul>
        <!-- 订单趋势图 -->
        <div id="ddqst">
            <!-- 查询条件 -->
            <form id="exportOrderViewLineFormId" action="#">
                <input name="dateStart" id="dateStartCityViewLine" type="text" style="display: none">
                <input name="dateEnd" id="dateEndCityViewLine" type="text" style="display: none">
                <input name="originCity" id="originCityViewLine" type="text" style="display: none">
                <input name="busiUuid" id="busiUuidViewLine" type="text" style="display: none">
                <input name="busiName" id="busiName" type="text" style="display: none">
                <input name="originCityName" id="originCityName" type="text" style="display: none">
            </form>
            <!-- 查询条件 -->
            <form class="form-inline" id="orderViewLineFormId" onsubmit="return false" style="margin: 25px;">
                <label>日期：</label>
                <input readonly="readonly" class="form-control" name="dateStart" id="dateStart" type="text">-
                <input readonly="readonly" class="form-control" name="dateEnd" id="dateEnd" type="text">
                <label>城市：</label>
                <select class="form-control" id="originCity2" name="originCity">
                    <option value="">请选择</option>
                </select>
                <label>业务类型：</label>
                <select class="form-control" id="busiUuid2" name="busiUuid">
                    <option value="" selected="selected">请选择</option>
                </select>
                <button class="layui-btn layui-btn-sm" id="searchBt1" onclick="line();"><i
                        class="layui-icon">&#xe615;</i>查询
                </button>
                <button class="layui-btn layui-btn-sm" id="exportBt1" onclick="orderViewLineExport();"><i
                        class="layui-icon"></i>导出
                </button>
            </form>
            <div id="container-day" class="chart" style="margin:50px 30px 20px 50px; height: 480px;"></div>
        </div>
        <!-- 日期对比图 -->
        <div style="display:none" id="rqdbt">
            <!-- 查询条件 -->
            <form class="form-inline" id="orderDataLineFormId" onsubmit="return false" style="margin: 25px;">
                <label>日期：</label>
                <input readonly="readonly" class="form-control" placeholder="请选择日期" name="dateStart1" id="dateStart1"
                       type="text">
                <input readonly="readonly" class="form-control" placeholder="请选择日期" name="dateStart2" id="dateStart2"
                       type="text">
                <input readonly="readonly" class="form-control" placeholder="请选择日期" name="dateStart3" id="dateStart3"
                       type="text">
                <input readonly="readonly" class="form-control" placeholder="请选择日期" name="dateStart4" id="dateStart4"
                       type="text">
                <input readonly="readonly" class="form-control" placeholder="请选择日期" name="dateStart5" id="dateStart5"
                       type="text">
                <button class="layui-btn layui-btn-sm" id="searchBt3" onclick="orderDateLineSeach();"><i
                        class="layui-icon">&#xe615;</i>查询
                </button>
                <p style="text-align: center;margin-top: 10px;">
                <ul style="text-align: center;margin-top: 10px;">
                    <li>
                        下单数：<input checked="checked" class="form-control" name="dataTpye" value="1" type="radio"
                                   onclick="orderDateLineSeach(0);">
                    </li>
                    <li>
                        接单数：<input class="form-control" name="dataTpye" value="2" type="radio"
                                   onclick="orderDateLineSeach(0);">
                    </li>
                    <li>
                        成单数：<input class="form-control" name="dataTpye" value="3" type="radio"
                                   onclick="orderDateLineSeach(0);">
                    </li>
                    <li>
                        成单率：<input class="form-control" name="dataTpye" value="4" type="radio"
                                   onclick="orderDateLineSeach(1);">
                    </li>
                </ul>

                </p>
            </form>
            <div id="dateLine" class="chart" style="margin:50px 30px 20px 50px; height: 480px;"></div>
        </div>
    </div>

    <div style="height: 10px;"></div>
    <div class="level_2" style="margin-top: 0px;">
        <div class="level_3">
            <div style="padding-bottom: 20px;font-size: 20px;font-family: 黑体;"><span>订单明细</span></div>
            <div>
                <header style="height: 100%">
                    <div align="left">
                        <table style="width: 90%">
                            <tr>
                                <td>
                                    <!-- 导出查询条件 -->
                                    <form id="colListExportFormId" action="#" method="post">
                                        <input name="orderUuid" id="orderUuidExport" type="text" style="display: none">
                                        <input name="orderSerial" id="orderSerialExport" type="text" style="display: none">
                                        <input name="payTime" id="payT1" type="text" style="display: none">
                                        <input name="orderCreateTime1" id="orderCreateTimeExport1" type="text"style="display: none">
                                        <input name="orderCreateTime2" id="orderCreateTimeExport2" type="text"style="display: none">
                                        <input name="confirmFareTime" id="confirmTimeExport" type="text"style="display: none">
                                        <input name="passMobile" id="passPhoneExport" type="text" style="display: none">
                                        <input name="driverPhone" id="driverPhoneExport" type="text" style="display: none">
                                        <input name="plateNum" id="carNumExport" type="text" style="display: none">
                                        <input name="licenseNum" id="licenseNumExport" type="text"style="display: none">
                                        <input name="orderStatus" id="orderStatusExport" type="text"style="display: none">
                                        <input name="payStatus" id="payStatusExport" type="text"style="display: none">
                                        <input name="colListName" id="colListName" type="text" style="display: none">
                                    </form>

                                    <form class="form-inline" onsubmit="return false">

                                        <div class="col-md-4" align="right">
                                            <p>
                                                <span>
                                                        订单ID:
                                                        <input style="width: 205px;" id="orderUuid" name="orderUuid"
                                                               type="text"
                                                               class="form-control" placeholder="订单ID">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        司机身份证:
                                                        <input style="width: 205px;" id="licenseNum"
                                                               name="licenseNum" type="text"
                                                               class="form-control"
                                                               placeholder="司机身份证号">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        订单时间:
                                                        <input style="width: 98px;" readonly="readonly" name="orderCreateTime1"
                                                               type="text" class="form-control" placeholder="订单时间"
                                                               id="orderCreateTime1">-
                                                        <input style="width: 98px;" readonly="readonly" name="orderCreateTime2"
                                                               type="text" class="form-control" placeholder="订单时间"
                                                               id="orderCreateTime2">
                                                </span>
                                            </p>
                                        </div>
                                        <div class="col-md-4" align="right">
                                            <p>
                                                <span>
                                                        订单号:
                                                        <input style="width: 150px;" id="orderSerial" name="orderSerial"
                                                               type="text"
                                                               class="form-control" placeholder="订单号">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        司机手机号:
                                                        <input style="width: 150px;" id="driverPhone" name="driverPhone"
                                                               type="text"
                                                               class="form-control"
                                                               placeholder="司机手机号">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        支付时间:
                                                        <input style="width: 150px;" readonly="readonly"
                                                               name="payTime" type="text"
                                                               class="form-control" placeholder="支付时间" id="payTime">
                                                    </span>
                                            </p>
                                        </div>
                                        <div class="col-md-4" align="right">
                                            <p>
                                                <span>
                                                        下单手机号:
                                                        <input style="width: 120px;" id="passMobile" name="passMobile"
                                                               type="text"
                                                               class="form-control"
                                                               placeholder="下单手机号">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        车牌号:
                                                        <input style="width: 120px;" id="plateNum" name="plateNum"
                                                               type="text" class="form-control"
                                                               placeholder="车牌号">
                                                </span>
                                            </p>
                                            <p>
                                                <span>
                                                        确认费用时间:
                                                        <input style="width: 120px;" readonly="readonly"
                                                               name="cofirmFareTime" type="text"
                                                               class="form-control"
                                                               placeholder="确认费用时间" id="cofirmFareTime">
                                                </span>
                                            </p>
                                        </div>
                                        <div class="col-md-4" align="right">
                                            <p>
                                                <span>
                                                    订单状态:
                                                            <select class="form-control input-sm" id="orderStatus"
                                                                    name="orderStatus" style="width: 70px">
                                                                <option value="" selected="selected">全部</option>
                                                                <option value="90">取消</option>
                                                                <option value="40">完成</option>
                                                            </select>
                                                       支付状态:
                                                            <select class="form-control input-sm" id="payStatus"
                                                                    name="payStatus" style="width: 70px">
                                                                <option value="" selected="selected">全部</option>
                                                                <option value="1">已支付</option>
                                                                <option value="2">未支付</option>
                                                            </select>
                                                </span>
                                            </p>

                                        </div>
                                        <div class="col-md-4" align="right" style="padding-left: 0px;padding-right: 145px;margin-top: 10px;">
                                            <button id="orderDetailSearchBt"
                                                    class="layui-btn layui-btn-sm"><i
                                                    class="layui-icon">&#xe615;</i>搜索
                                            </button>
                                            <div class="btn-group">
                                                <button class="layui-btn layui-btn-sm" data-toggle="dropdown">导出</button>
                                                <ul class="dropdown-menu">
                                                    <li><p class="drvDailyWorkExport" style="height: 20px;" onclick="orderDetailExport(1);">导出列表</p></li>
                                                    <li><p class="drvDailyWorkExportCustom" style="height: 38px;" onclick="orderDetailExport(2);">导出-自定义</p></li>
                                                </ul>
                                            </div>
                                            <p>
                                                <span>



                                                    <!--<button class="layui-btn layui-btn-sm"
                                                            onclick="orderDetailExport(1);"><i
                                                            class="layui-icon ayui-icon-export"></i>导出列表
                                                            </button>
                                                     <button class="layui-btn layui-btn-sm"
                                                             onclick="orderDetailExport(2);"><i
                                                             class="layui-icon ayui-icon-export"></i>自定义导出
                                                            </button>-->
                                                </span>
                                            </p>

                                        </div>

                                    </form>
                                </td>
                            </tr>
                        </table>
                    </div>
                </header>

                <div id="tableArea" style="margin-top: 10px;">
                    <div class="widget-body no-padding">
                        <table id="dt-table" class="table table-striped table-bordered table-hover "
                               style="white-space: nowrap;">
                            <thead>
                            <tr>
                            </tr>
                            <tr>
                                <th>订单ID</th>
                                <th>订单号</th>
                                <th>订单类型</th>
                                <th>订单状态</th>
                                <th>订单来源</th>
                                <th>支付状态</th>
                                <th>支付方式</th>
                                <th>计费里程</th>
                                <th>起点</th>
                                <th>终点</th>
                                <th>司机姓名</th>
                                <th>司机身份证</th>
                                <th>车牌号</th>
                                <th>下单手机</th>
                                <th>用车人手机</th>
                                <th>下单时间</th>
                                <th>用车时间</th>
                                <th>取消时间</th>
                                <th>接单时间</th>
                                <th>去接乘客时间</th>
                                <th>到达上车点时间</th>
                                <th>乘客上车时间</th>
                                <th>到达目的地时间</th>
                                <th>确认费用时间</th>
                                <th>支付时间</th>
                                <th>司机总额</th>
                                <th>订单优惠金额</th>
                                <th>优惠券金额</th>
                                <th>客服改价金额</th>
                                <th>实付金额</th>
                                <th>取消方</th>
                                <th>取消理由</th>

                            </tr>
                            </thead>
                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<!-- START 自定义导出弹窗 -->
<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    自定义导出
                </h4>
            </div>
            <div class="modal-body">
                <!--在这里添加一些文本-->
                <div class="row-fluid">
                    <div class="span12">
                        <form action="#" method="post" class="form-horizontal">
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单UUID"/>订单ID
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单号"/>订单号
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单类型"/>订单类型
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单状态"/>订单状态
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单来源"/>订单来源
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="支付状态"/>支付状态
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="支付方式"/>支付方式
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="计费里程"/>计费里程
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="起点"/>起点
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="终点"/>终点
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="司机姓名"/>司机姓名
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="司机手机号"/>司机手机号
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="司机身份证号码"/>司机身份证
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="车牌号"/>车牌号
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="下单手机号"/>下单手机号
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="实际乘车人手机号"/>实乘人手机号
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="下单时间"/>下单时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="用车时间"/>用车时间
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="取消时间"/>取消时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="司机接单时间"/>司机接单时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="去接乘客时间"/>去接乘客时间
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="到达上车点时间"/>到达上车点时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="乘客上车时间"/>乘客上车时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="到达目的地时间"/>到达目的地时间
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="确认费用时间"/>确认费用时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="支付费用时间"/>支付费用时间
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="司机总额"/>司机总额
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="订单优惠金额"/>订单优惠金额
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="优惠券金额"/>优惠券金额
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="客服改价金额"/>客服改价金额
                                </div>
                            </div>
                            <div class="form-group">
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="实付金额"/>实付金额
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="取消方"/>取消方
                                </div>
                                <div class='col-sm-4 col-sm-service-info2'>
                                    <input type="checkbox" name="orderList" value="取消理由"/>取消理由
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary orderCunlomSave">确认</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
            </div>
        </div>
    </div>
</div>
<!-- END 自定义导出弹窗 -->

</body>
</html>

<script type="text/javascript" src="../../js/libs/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="../../js/jq.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="../../js/plugin/datatables/dataTables.bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/echarts/echarts.min.js"></script>
<script type="text/javascript" src="../../layui/layui.js"></script>
<script type="text/javascript" src="../../layui/layui.all.js"></script>
<script type="text/javascript" src="../../js/my/permission.js"></script>
<script type="text/javascript" src="../../js/libs/bootstrap.min.js"></script>
<script type="text/javascript" src="../../js/common.js"></script>
<script type="text/javascript">

    var pers = checkPermission();
    $('#myTab a:first').tab('show');//初始化显示哪个tab

    //点击Tab页切换
    $('ul li a').bind('click', function () {
        var tabId = $(this).attr("href");
        if (tabId == "#tab_1") {
            $("#ddqst").show();
            $("#rqdbt").hide();
            orderViewInit();
            $('#myTab a:first').tab('show')
        } else if (tabId == "#tab_2") {
            $("#ddqst").hide();
            $("#rqdbt").show();
            $('#myTab a:last').tab('show')
            orderDateLineSeach();
        }
    });

    var myDate = new Date(new Date() - 1000 * 60 * 60 * 24),
        yestery = myDate.getFullYear(),
        yesterm = myDate.getMonth() + 1,
        yesterd = myDate.getDate(),
        yesterh = myDate.getHours(),
        yestermin = myDate.getMinutes(),
        yesters = myDate.getSeconds(),
        yesterDay = yestery + "-" + yesterm + "-" + yesterd + " " + yesterh + ":" + yestermin + ":" + yesters;

    //点击自定义导出 1 全部导出，2自定义导出
    function orderDetailExport(type) {

        //查询条件放入 导入的from表单，为导出做准备
        $('#orderUuidExport').val($('#orderUuid').val());
        $('#orderSerialExport').val($('#orderSerial').val());
        $("#payT1").val($("#payTime").val());
        $('#orderCreateTimeExport1').val($('#orderCreateTime1').val());
        $('#orderCreateTimeExport2').val($('#orderCreateTime2').val());
        $('#confirmTimeExport').val($('#confirmTime').val());
        $('#passPhoneExport').val($('#passPhone').val());
        $('#driverPhoneExport').val($('#driverPhone').val());
        $('#carNumExport').val($('#carNum').val());
        $('#driverCardIdExport').val($('#driverCardId').val());
        $('#orderStatusExport').val($('#orderStatus').val());
        $('#payStatusExport').val($('#payStatus').val());

        if (type == 2) {
            $('#myModal').modal('show');
        } else {
            var str = "";
            $("input[name='orderList']:checkbox").each(function () {
                str += $(this).attr("value") + ",";
            });
            str += "序号";
            $("#colListName").val(str);
            $('#colListExportFormId').attr("action", "/orderDetails/getOrderDetailsExport");
            $('#colListExportFormId').submit();
        }
    }

    //自定义导出确认`
    $('.orderCunlomSave').on('click', function () {

        $('#myModal').modal('hide');
        var str = "";
        $("input[name='orderList']:checkbox").each(function () {
            if ($(this).is(":checked")) {
                str += $(this).attr("value") + ",";
            }

        });
        str += "序号";
        $("#colListName").val(str);
        $('#colListExportFormId').attr("action", "/orderDetails/getOrderDetailsExport");
        $('#colListExportFormId').submit();
    });

    //layui空间初始化载入
    function layui_load() {
        layui.use('layer', function () {
            var layer = layui.layer;
        });
        layui.use(['layer', 'laydate'], function () {
            var layer = layui.layer;
            var laydate = layui.laydate;

            //订单概览时间初始化
            laydate.render({
                elem: '#beginTime',//指定元素
                trigger: 'click',
                max: maxDate(),
                btns: ['confirm'], //去除"现在,清空"按钮
                type: 'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                value: maxDate(), // 指定值，昨天
            });

            //订单趋势时间初始化
            var dateEnd = laydate.render({
                elem: '#dateEnd',
                max: maxDate(),
                trigger: 'click',
                type: 'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                btns: ['confirm'], //去除"现在,清空"按钮
                value: maxDate(), // 指定值，昨天
                done: function (value, date) {
                    dateStart.config.max = {
                        year: date.year,
                        month: date.month - 1,//注意是month-1，写在date上的话你后边的日期选择不了
                        date: date.date
                    }
                }
            });

            var dateStart = laydate.render({
                elem: '#dateStart',
                max: maxDate(),
                trigger: 'click',
                btns: ['confirm'], //去除"现在,清空"按钮
                type: 'date', // 可选择：年、月、日
                format: 'yyyy-MM-dd', //指定时间格式
                value: maxDate(), // 指定值，昨天
                done: function (value, date) {
                    dateEnd.config.min = {
                        year: date.year,
                        month: date.month - 1,
                        date: date.date
                    };
                }

            });

            //日期对比图时间初始化
            laydate.render({
                elem: '#dateStart1',
                max: maxDate(),
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click'
            });
            laydate.render({
                elem: '#dateStart2',
                max: maxDate(),
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click'
            });
            laydate.render({
                elem: '#dateStart3',
                max: maxDate(),
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click'
            });
            laydate.render({
                elem: '#dateStart4',
                max: maxDate(),
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click'
            });
            laydate.render({
                elem: '#dateStart5',
                max: maxDate(),
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click'
            });

            //订单明细 订单时间 初始化时间控件
            var orderCreateTime1 = laydate.render({
                elem: '#orderCreateTime1',
                max: maxDate(),
                type: 'date', // 可选择：年、月、日
                btns: ['confirm'], //去除"现在,清空"按钮
                format: 'yyyy-MM-dd', //指定时间格式
                value: maxDate(), // 指定值，昨天
                trigger: 'click',
                done: function (value, date) {
                    orderCreateTime2.config.min = {
                        year: date.year,
                        month: date.month - 1,//注意是month-1，写在date上的话你后边的日期选择不了
                        date: date.date
                    }
                }
            });
            var orderCreateTime2 = laydate.render({
                elem: '#orderCreateTime2',
                max: maxDate(),
                type: 'date', // 可选择：年、月、日
                btns: ['confirm'], //去除"现在,清空"按钮
                format: 'yyyy-MM-dd', //指定时间格式
                value: maxDate(), // 指定值，昨天
                trigger: 'click',
                done: function (value, date) {
                    orderCreateTime1.config.max = {
                        year: date.year,
                        month: date.month - 1,
                        date: date.date
                    };
                }

            });


            laydate.render({
                elem: '#payTime',
                max: yesterDay,
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click',
                btns: ['clear', 'confirm'], //去除"现在"按钮
            });
            laydate.render({
                elem: '#cofirmFareTime',
                max: yesterDay,
                type: 'date',
                format: 'yyyy-MM-dd',
                value: '',
                trigger: 'click',
                btns: ['clear', 'confirm'], //去除"现在"按钮
            });
        });

    }

    //获取开通城市和业务线
    function serchInit() {
        $.ajax({
            type: 'get',
            url: '/common/getCity',
            success: function (d) {
                var data = d.data;
                var str = "<option value=''>请选择</option>";
                for (var i = 0; i < data.length; i++) {
                    var uuid = data[i].uuid;
                    var name = data[i].name;
                    str += "<option value=" + uuid + ">" + name + "</option>";
                }
                $("#originCity").html(str);
                $("#originCity2").html(str);
            }
        });
        $.ajax({
            type: 'get',
            url: '/common/getBusi',
            success: function (d) {
                var data = d.data;
                var str = "<option value='' selected='selected'>请选择</option>";
                for (var i = 0; i < data.length; i++) {
                    var uuid = data[i].uuid;
                    var label = data[i].label;
                    str += "<option value=" + uuid + ">" + label + "</option>";
                }
                $("#busiUuid").html(str);
                $("#busiUuid2").html(str);
            }
        });
    }

    //订单概览导出
    function orderViewExport() {
        $("#beginTimeExport").val($("#beginTime").val());
        $("#originCityExport").val($("#originCity").val());
        $("#busiUuidExport").val($("#busiUuid").val());
        $("#sourceExport").val($("#source").val());
        $('#exportFormId').attr("action", "/orderAnalyse/getOrderViewExport");
        $('#exportFormId').submit();
    }

    //订单趋势导出
    function orderViewLineExport() {
        $("#dateStartCityViewLine").val($("#dateStart").val());
        $("#dateEndCityViewLine").val($("#dateEnd").val());
        $("#originCityViewLine").val($("#originCity2").val());
        $("#busiUuidViewLine").val($("#busiUuid2").val());
        $("#busiName").val($("#busiUuid2 option:selected").text());
        $("#originCityName").val($("#originCity2 option:selected").text());

        $('#exportOrderViewLineFormId').attr("action", "/orderAnalyse/getOrderViewLineExport");
        $('#exportOrderViewLineFormId').submit();
    }

    //订单概览
    function orderViewInit() {
        $.ajax({
            type: 'get',
            url: '/orderAnalyse/getOrderView',
            data: $("#orderViewFormId").serialize(),
            success: function (data) {
                $("#xd").html(data.data[0]);
                $("#jd").html(data.data[1]);
                $("#cd").html(data.data[2]);
                $("#cdl").html(data.data[3] + '%');
            }
        });


    }

    //日期对比图
    function orderDateLineSeach(index_) {
        $.ajax({
            type: 'get',
            url: '/orderAnalyse/getOrderViewLineByDate',
            data: $("#orderDataLineFormId").serialize(),
            success: function (data) {
                var val = $('input[name="dataTpye"]:checked').val();
                if (val == 4) {
                    index_ = 1;
                } else {
                    index_ = 0;
                }
                var date1 = data.date1;
                var date2 = data.date2;
                var date3 = data.date3;
                var date4 = data.date4;
                var date5 = data.date5;

                var dateName1 = $("#dateStart1").val();
                var dateName2 = $("#dateStart2").val();
                var dateName3 = $("#dateStart3").val();
                var dateName4 = $("#dateStart4").val();
                var dateName5 = $("#dateStart5").val();
                var chart = echarts.init(document.getElementById('dateLine'));
                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    grid: {
                        top: '10%',
                        right: '10%'
                    },
                    toolbox: {
                        feature: {
                            dataView: {show: false, readOnly: false},
                            restore: {show: false},
                            saveAsImage: {show: false}
                        }
                    },

                    legend: {
                        icon: 'circle',
                        itemWidth: 6,
                        itemGap: 20,
                        textStyle: {
                            color: '#556677'
                        }
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisTick: {
                                alignWithLabel: true
                            },
                            data: ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23']
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '',
                            position: 'left',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '(%)',
                            position: 'right',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
                    ],
                    series: [{
                        type: 'line',
                        name: dateName1,
                        data: date1,
                        smooth: true,
                        yAxisIndex: index_,
                        color: '#3AA1FF'
                    }, {
                        type: 'line',
                        name: dateName2,
                        data: date2,
                        smooth: true,
                        yAxisIndex: index_,
                        color: '#5EC67D'
                    }, {
                        type: 'line',
                        name: dateName3,
                        data: date3,
                        smooth: true,
                        yAxisIndex: index_,
                        color: '#FFFF00'
                    }, {
                        type: 'line',
                        name: dateName4,
                        data: date4,
                        smooth: true,
                        yAxisIndex: index_,
                        color: '#FFA07A'
                    }, {
                        type: 'line',
                        name: dateName5,
                        data: date5,
                        smooth: true,
                        yAxisIndex: index_,
                        color: '#8F8F8F'
                    }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                chart.setOption(option);
            }
        });
    }

    //首次进入页面是0
    var pageInit = 0;

    //订单趋势 数据
    function line() {

        var dateStart = $('#dateStart').val();
        var dateEnd = $('#dateEnd').val();
        if (pageInit != 0 && (dateStart.length == 0 || dateEnd.length == 0)) {
            layer.msg('查询时间选择错误');
            return
        }
        if(new Date(dateStart).getTime() > new Date(dateEnd).getTime()){
            layer.msg('查询时间选择错误');
            return
        }
        if(!checkDatelimit(dateStart,dateEnd)){
            alert("日期选择跨度不能超过一个月");
            return;
        }

        pageInit++;
        $.ajax({
            type: 'get',
            url: '/orderAnalyse/getOrderViewLine',
            data: $("#orderViewLineFormId").serialize(),
            success: function (data) {
                var xdstr = data.xdstr;
                var cdstr = data.cdstr;
                var jdstr = data.jdstr;
                var cdlstr = data.cdlstr;
                var XDate = data.XDate;

                var chart = echarts.init(document.getElementById('container-day'));

                option = {
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross'
                        }
                    },
                    grid: {
                        top: '10%',
                        right: '10%'
                    },
                    toolbox: {
                        feature: {
                            dataView: {show: false, readOnly: false},
                            restore: {show: false},
                            saveAsImage: {show: false}
                        }
                    },

                    legend: {
                        icon: 'circle',
                        itemWidth: 6,
                        itemGap: 20,
                        textStyle: {
                            color: '#556677'
                        }
                    },
                    xAxis: [
                        {
                            type: 'category',
                            axisTick: {
                                alignWithLabel: true
                            },
                            data: XDate//['0','1','2','3','4','5','6','7','8','9','10','11','12','13','14','15','16','17','18','19','20','21','22','23']
                        }
                    ],
                    yAxis: [
                        {
                            type: 'value',
                            name: '',
                            position: 'left',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        },
                        {
                            type: 'value',
                            name: '(%)',
                            position: 'right',
                            axisLine: {
                                lineStyle: {
                                    color: '#000000'
                                }
                            },
                            axisLabel: {
                                formatter: '{value}'
                            }
                        }
                    ],
                    series: [{
                        type: 'line',
                        name: '下单数',
                        data: xdstr,
                        smooth: true,
                        color: '#3AA1FF'
                    }, {
                        type: 'line',
                        name: '接单数',
                        data: jdstr,
                        smooth: true,
                        color: '#5EC67D'
                    }, {
                        type: 'line',
                        name: '成单数',
                        data: cdstr,
                        smooth: true,
                        color: '#FFFF00'
                    }, {
                        type: 'line',
                        name: '成单率',
                        data: cdlstr,
                        smooth: true,
                        yAxisIndex: 1,
                        color: '#FFA07A'
                    }
                    ]
                };

                // 使用刚指定的配置项和数据显示图表。
                chart.setOption(option);
            }
        });
    }

    //订单明细
    var example;

    function orderDetailInit() {

        example =
            $('#dt-table').DataTable({
                "searching": false,
                "processing": false,
                "serverSide": true,
                "bProcessing": true,
                "language": {
                    "url": "/js/plugin/datatables/Chinese.lang",
                },
                /*  "oLanguage":{
                      "sProcessing" : "<img src='../../img/loading/1.gif'>"  //如果不需要用加载中图片显示，这句话可以不要
                  },*/
                "ajax": {
                    "url": "/orderDetails/getOrderDetails",
                    "type": "post",
                    "data": function (d) {
                        d.orderUuid = $('#orderUuid').val();
                        d.orderSerial = $('#orderSerial').val();
                        d.payTime = $('#payTime').val();
                        d.orderCreateTime1 = $('#orderCreateTime1').val();
                        d.orderCreateTime2 = $('#orderCreateTime2').val();
                        d.confirmFareTime = $('#cofirmFareTime').val();
                        d.passMobile = $('#passMobile').val();
                        d.driverPhone = $('#driverPhone').val();
                        d.plateNum = $('#plateNum').val();
                        d.licenseNum = $('#licenseNum').val();
                        d.orderStatus = $('#orderStatus').val();
                        d.payStatus = $('#payStatus').val();
                    },
                    "error": function (xhr, textStatus, errorThrown) {
                        var msg = xhr.responseText;
                        console.log(msg);
                        var response = JSON.parse(msg);
                        var code = response.code;
                        var message = response.message;
                        if (code == 400) {
                            layer.msg(message);
                        } else if (code == 401) {
                            localStorage.removeItem("token");
                            layer.msg("token过期，请先登录", {shift: -1, time: 1000}, function () {
                                location.href = '/login.html';
                            });
                        } else if (code == 403) {
                            console.log("未授权:" + message);
                            layer.msg('未授权');
                        } else if (code == 500) {
                            layer.msg('系统错误：' + message);
                        }
                    }
                },
                "dom": "<'dt-toolbar'r>t<'dt-toolbar-footer'<'col-sm-10 col-xs-12 hidden-xs'i><'col-xs-12 col-sm-10' p v>>",
                "columns": [
                    {"data": "orderUuid", "defaultContent": "", "orderable": false},
                    {"data": "orderSerial", "defaultContent": "", "orderable": false},
                    {"data": "orderType", "defaultContent": "", "orderable": false},
                    {"data": "orderStatus", "defaultContent": "", "orderable": false},
                    {"data": "orderSource", "defaultContent": "", "orderable": false},
                    {"data": "payStatus", "defaultContent": "", "orderable": false},
                    {"data": "payType", "defaultContent": "", "orderable": false},
                    {"data": "tripDistance", "defaultContent": "", "orderable": false},
                    {"data": "originAddressDetail", "defaultContent": "", "orderable": false},
                    {"data": "destAddressDetail", "defaultContent": "", "orderable": false},
                    {"data": "actualName", "defaultContent": "", "orderable": false},
                    {"data": "licenseNum", "defaultContent": "", "orderable": false},
                    {"data": "plateNum", "defaultContent": "", "orderable": false},
                    {"data": "passMobile", "defaultContent": "", "orderable": false},
                    {"data": "actualPassMob", "defaultContent": "", "orderable": false},
                    {"data": "orderCreateTime", "defaultContent": "", "orderable": false},
                    {"data": "departTime", "defaultContent": "", "orderable": false},
                    {"data": "cancelTime", "defaultContent": "", "orderable": false},
                    {"data": "takingOrderTime", "defaultContent": "", "orderable": false},
                    {"data": "drvGoTime", "defaultContent": "", "orderable": false},
                    {"data": "drvArrTime", "defaultContent": "", "orderable": false},
                    {"data": "pasArrTime", "defaultContent": "", "orderable": false},
                    {"data": "arriveTime", "defaultContent": "", "orderable": false},
                    {"data": "confirmFareTime", "defaultContent": "", "orderable": false},
                    {
                        "data": "payTime", "defaultContent": "", "orderable": false,
                        "render": function (obj, type, row) {
                            if (obj == null || obj == '') {
                                return "-";
                            }
                            return obj;
                        }
                    },
                    {"data": "drvTotalFare", "defaultContent": "", "orderable": false},
                    {"data": "orderCouponFare", "defaultContent": "", "orderable": false},
                    {"data": "couponFare", "defaultContent": "", "orderable": false},
                    {"data": "adjustFare", "defaultContent": "", "orderable": false},
                    {"data": "actualFare", "defaultContent": "", "orderable": false},
                    {"data": "cancelObject", "defaultContent": "", "orderable": false},
                    {"data": "cancelReason", "defaultContent": "", "orderable": false}
                ]
            });
    }

    //订单明细查询
    $("#orderDetailSearchBt").click(function () {

        var orderCreateTime1 = $('#orderCreateTime1').val();
        var orderCreateTime2 = $('#orderCreateTime2').val();
        if (orderCreateTime1.length == 0 || orderCreateTime2.length == 0) {
            layer.msg('支付时间选择错误');
            return
        }
        if(new Date(orderCreateTime1).getTime() > new Date(orderCreateTime2).getTime()){
            layer.msg('查询时间选择错误');
            return
        }
        if(!checkDatelimit(orderCreateTime1,orderCreateTime2)){
            alert("日期选择跨度不能超过一个月");
            return;
        }

        example.ajax.reload();
    });


    //初始化
    layui_load();
    orderViewInit();
    serchInit();
    line();
    orderDetailInit();

</script>